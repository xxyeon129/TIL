# Ch03: Fast & Gigabit Ethernet

> [!NOTE]
> 전송 속도의 가장 기본은 bit per sec (10^3 kbps → 10^6 kbps → 10^9 Gbps)

# 01 LAN 스위치의 개요

## 기존의 공유매체 기반 LAN의 문제점

- 공유매체 기반 LAN: 과거 LAN 환경에서는 여러 노드(컴퓨터나 네트워크 장비)가 하나의 전송매체(ex. 이더넷 케이블)를 공유하여 데이터를 주고받았다.
- **충돌 문제:** 여러 노드가 동시에 데이터를 전송하려고 하면 충돌이 발생
- **실시간 전송, 대용량 데이터 전송의 한계:** 실시간 데이터(화상 회의, 음성 통화)나 대용량 데이터 전송에는 충돌 문제가 더 심각해져 기존의 공유매체 방식은 적절하지 않았다.

## LAN 스위칭

LAN 스위칭: 각각의 LAN segment를 스위치의 포트에 연결하여 동작하는 방식

(\*LAN segment: 네트워크를 물리적/논리적으로 나눈 한 부분. 각 segment는 자체적인 통신을 담당)

- **독립적인 LAN segment:**
  - LAN 스위칭 환경에는 각 segment가 독립적으로 동작
  - 하나의 LAN segment에서 발생한 데이터 충돌이 다른 segment에 영향을 미치지 않기 때문에 → 충돌 도메인이 축소됨
- 스위치의 처리 속도는 기존의 브리지나 라우터보다 성능이 좋다.
- ASIC(Application Specific Integrated Circuit, 주문형 반도체) 기술의 발전으로 스위칭을 CPU가 아닌, ASIC라는 하드웨어가 수행하게 함으로써 → 스위칭 속도를 크게 향상시킬 수 있었다.

> [!NOTE]
>
> - IC(Integrated Circuit): 집적 회로
> - ASIC: 어플리케이션이 지정된 집적 회로. 스위칭을 빨리 할 수 있는 반도체
> - 교통 상황을 통제하여 빠른 속도로 자동차가 이동하듯, 어플리케이션을 지정해 스위칭 속도를 향상시킴

## 충돌 도메인과 브로드캐스트 도메인(Broadcast Domain)

- 2계층은 segment 내의 통신을 담당하고, segment 범위 안은 허브나 스위치로 분리한다.
- **허브**는 CSMA/CD를 통해 충돌을 처리
  - CSMA/CD(Carrier Sense Multiple Access with Collision Detection): 여러 장치가 동시에 데이터를 전송하려고 할 때 충돌이 발생할 수 있는데, 허브는 충돌 발생 시 이를 감지하고 데이터를 다시 전송하는 방식으로 충돌을 처리
- **스위치**는 충돌을 미연에 방지하기 위해 `MAC 주소 필터링`과 `버퍼링`을 사용
  - MAC 주소 필터링: 도메인 안에 같은 MAC 주소(네트워크 인터페이스의 고유 주소)가 있으면 피해가서 충돌 방지
  - 버퍼링: 데이터가 전송되기 전에 임시 저장공간(버퍼)에 저장하고, 필요할 때 전송해서 충돌 방지
- **충돌 도메인:** 데이터 충돌이 일어날 수 있는 범위(허브나 스위치가 구분자)
- **브로드캐스트 도메인:** 네트워크 내에서 브로드캐스트 패킷(모든 장치에 전송되는 데이터)이 도달할 수 있는 범위 (라우터가 구분자)
  - 라우터: 브로드캐스트 도메인을 나누는 장치로, 네트워크를 구분지어 브로드캐스트가 다른 네트워크로 전파되지 않도록 함

<br />

# 02 공유 LAN과 스위칭 LAN

- 반 이중 방식 (Half Duplex Mode)
  - 양방향으로 데이터가 전송될 수 있으나, 동시에 전송하는 것은 불가능한 방식
  - 한 번에 한쪽 방향으로만 데이터 전송이 가능한 단방향 통신 방식
  - 교대로 송수신 → ex. 무전기, 워키토키
- 전 이중 방식 (Full Duplex Mode)
  - 하나의 전송 선로에서 데이터가 동시에 양 방향으로 전송될 수 있는 방식으로 충돌이 발생하지 않는다.

<br />

# 03 Switch

## ✅ 스위치의 종류

### 응용 방법에 의한 구분

- **대칭 스위치:** 동일 대역폭을 가진 LAN 세그먼트에 대한 스위칭
- **비대칭 스위치:** 다른 대역폭을 가진 LAN 세그먼트에 대한 스위칭

### OSI 참조모델에 의한 구분

- **Layer 2 Switch(2계층 스위치) - Data link layer**
  - 데이터 링크 계층에서는 물리적인 장치의 MAC 주소를 사용해 데이터를 전달함
- 스위치에 연결된 장치들의 **MAC 주소를 학습**하여 이 정보를 바탕으로 **스위칭 테이블**을 생성, 갱신
- 스위치는 스위칭 테이블을 참고하여 출발한 데이터를 적합한 경로로 전달(스위칭)
- **Layer 3 Switch(3계층 스위치) - Network layer**
  - 네트워크 계층에서는 IP 주소를 사용해 데이터 경로를 결정
- **IP 주소 기반 스위칭:** IP 주소를 사용해 네트워크를 구분, 각 네트워크 간의 데이터를 전달할 수 있는 최적의 경로를 찾아 스위칭
- **IP 주소표기법(CIDR**: Classless Inter-Domain Routing): IP주소 영역을 여러 네트워크 영역으로 나눌 때 사용하는 방식
  - `1.1.1.1/24`는 앞의 24비트가 네트워크 주소를 나타내고, 나머지 8비트가 호스트 주소를 나타냄
  - subnet bit를 1로 표기: `1.1.1.1/24` - 앞 24자리는 1, 나머지 8자리는 0)
- subnet mask 표기법: `1.1.1.1(255.255.255.255)`

> [!TIP]
> trace route 스마트폰 앱으로 라우터 연결을 확인하고 추적해볼 수 있음.

- **Layer 4 Switch(4계층 스위치) - Transport layer**

- 전송 계층은 TCP(Transmission Control Protocol)나 UDP(User Datagram Protocol)과 같은 프로토콜을 사용해 데이터 전송을 관리
- TCP나 UDP 등의 헤더에 포함된 **포트 번호를 기준**으로 해당 **패킷을 전달할 경로 설정**
- L4 스위치의 특징
  - Transparent service: 사용자가 의식하지 못하게 자동으로 동작한다
  - Appliance Server: 특정 목적에 최적의 성능을 낼 수 있도록 / 하드웨어, 운영체제, 소프트웨어가 모두 설치된 상태로 제공되는 서버 (사용자는 추가설정 없이 바로 사용할 수 있음)

- 

## ✅ 스위치의 동작

주로 2계층(Data Link Layer)에서 MAC 주소를 기반으로 데이터를 전달

이를 통해 LAN 내에서 데이터 프레임을 중계하는 역할을 수행

### 스위치의 구성 요소

전송 로직, 입출력 포트로 구성

- **전송 로직:** 스위치의 내부에서 **데이터를 전달하는 규칙**을 정하는 부분
- **입출력 포트:** 네트워크 장비와 연결되는 물리적 포트로, 데이터를 **송수신**
    - LAN 또는 WAN과 연결할 수 있음
    - LAN 스위치는 2계층(Data Link Layer) 상에서 여러 개의 네트워크 연결 시 사용
    - LAN 스위치에는 많은 종류의 물리적 인터페이스가 존재하게 되는데, / **입출력 포트**는 다양한 물리적 인터페이스에 상관 없이 / **기본적인 스위치의 전송 로직을 바꾸지 않아도 된다.**
    - **`액세스(access) 포트`**: **LAN** 상에 있는 각 **호스트를** **연결하기 위해** 사용하는 **물리적인 인터페이스**
    - **`네트워크 업 링크(Network Uplink) 포트`**: 한 스위치가 다른 스위치와 연결할 때 사용하는 포트

    

### 스패닝 트리 알고리즘(Spanning Tree Algorithm)

루핑을 방지하기 위해 **유일한 경로**만 남기고 나머지 경로는 **차단**하는 알고리즘

- Spanning Tree:
    - 모든 노드가 연결되어 있지만, 노드 간 경로는 오직 하나만 존재하여 루프가 없는 최소 연결 네트워크를 형성
    - 노드들을 최소한의 연결(가장 적은 수의 간선)로 연결하여 루프를 방지
- Spanning Tree Algorithm
    - 스위치나 브리지에서 looping 발생을 방지
    - 여러 경로가 존재할 때 하나의 경로만 활성화하고 나머지 경로는 차단
    - 기존 경로에 장애가 발생하면, 차단해둔 경로를 활성화해 네트워크 연결을 유지

### BPDU(Bridge Protocol Data Unit) 패킷 교환

각 브리지(스위치)는 1~10초 간격으로 BPDU(bridge Protocol Data Unit) 패킷 교환하여 **링크 상태 정보를 공유**

→ 이를 통해 스패닝 트리 알고리즘이 네트워크 토폴로지의 변경을 감지하고, looping 없는 구조를 유지할 수 있게 함

## ✅ 스위치의 전송 로직

### 필터/전송 로직 (Forwarding, Flooding)

- 스위치에 수신되는 모든 프레임의 목적지 주소를 확인하고, 이를 기반으로 행동
- 수신한 프레임의 **목적지 주소를  `전송 로직`에서 검사**하고, **목적지 주소가 송신지 주소 테이블에 존재하는지 확인**
    - 목적지 주소가 송신지 주소 테이블에 존재하지만 & 주소의 위치가 수신 포트가 아닌 다른 포트라면 → 해당 포트로 프레임을 전송
    - 송신지 주소 테이블의 목적지가 == 현재 프레임을 수신한 포트와 같다면 → 해당 프레임은 폐기함으로 `필터링`
    - 송신지 주소 테이블이 목적지 주소에 대한 정보가 없다면 → 스위치는 해당 프레임을 모든 포트로 전송(`플러딩(flooding)`)시킨다.

### 학습 로직 (Learning)

**MAC 주소와 위치 정보 수집:**

- 스위치는 네트워크의 스테이션(호스트)들이 사용하는 MAC 주소, 송신지 주소 테이블의 위치 정보를 학습
    - 스위치가 초기화됐을 때는 어떤 MAC 주소도 알고 있지 않다.

**주소 테이블 업데이트:**

- 호스트들의 **MAC 주소와 송신지 위치 정보를 수집**하여, 새로운 MAC 주소와 해당 포트를 송신지 주소 테이블에 업데이트 → 이러한 학습은 (수신한 각 프레임이 전송되든 폐기되든 상관 없이) **수신될 때마다 수행**됨
- 이미 존재하는 엔트리의 경우, 경과시간 타이머를 갱신

### 송신지 MAC 주소 테이블

**프레임 흐름 제어:**

- LAN 스위치는 / 송신지 MAC 주소 테이블을 기반으로 / 프레임을 어디로 전송할지 결정함
    - 송신지 MAC 주소 테이블은 **`학습로직`에 의해 갱신**되며, `필터/전송 로직`에 의해 수신한 프레임 전송을 결정하기 위해 사용됨
- 테이블은 **MAC 주소 목록**과 (해당 MAC 프레임을 수신한) **최근 포트 정보**로 구성
    - 네트워크 구성 시 송신지 주소 테이블은 빈 상태이며, / 프레임을 스위치가 수신하면 → 스위치는 송신지 MAC 주소와 해당 포트번호를 송신지 주소 테이블에 추가한다. 이러한 방식으로 각 호스트의 MAC 주소와 포트를 송신 주소 테이블에 추가하여 완성한다.

**타이머:**

- 테이블 내의 엔트리들은 / MAC 주소 정보가 **언제 폐기될 것인가를 결정하는 경과 시간 타이머**를 가지고 있음

**제한된 크기:**

- 스위치 내의 송신지 주소 테이블의 크기는 제한적 → 하나의 LAN 스위치가 담당할 수 있는 MAC 주소의 수는 제한적

---

### 포트 인터페이스

물리적인 포트의 논리적인 인터페이스

- 1계층(물리층)과 2계층(Data Link Layer)의 기능을 모두 수행
- 1계층의 정보를 → 2계층의 MAC 프레임으로 변환

## ✅ 스위칭 방법에 따른 스위치 분류

### ✔️ Cut-Through 스위치

- (전체 프레임을 모두 받기 전에) **프레임의 송신지, 수신지 주소를 얻기 위해 / 프레임의 첫 번째 몇 바이트만을 읽고 / 목적지 MAC 주소만 확인**하는 전송 방식
- 오늘날 대부분의 스위칭 방식
- ✨ 빠른 전송 속도, 짧은 지연 시간 → 전송 지연 최소화
- 💩 전송 효율은 떨어짐

### ✔️ Interim Cut-Through 스위치(중간) = Fragment-free 스위치

- **프레임의 64바이트 정보만 확인**하여 → **충돌 여부를 확인**하는 방식
    - 최소 이더넷 프레임 길이가 64바이트이기 때문에, 64바이트 정보를 확인함으로써 충돌 여부 검사
- Cut-Through 스위치의 단점을 보완한 중간 방식
- ✨런트(runt) 프레임(너무 작은 프레임)이 네트워크에 전송되는 것을 방지

### ✔️ Store-and-Forward 스위치

**전체 프레임을 스위치가 수신**한 후, **에러 여부를 검사**하고 전송을 결정하는 방식

- 스위치에 유입된 **모든 프레임**에 대해 **`CRC(순환중복검사) 값`**과 **`FCS(Frame Check Sequence; 프레임 순서 체크)`을 비교**해 **에러 여부를 확인**하는 방식
- 스위치가 프레임을 전송하기 전에 / **전체 프레임을 수신**하는 방식으로 / 기존의 브리지와 거의 같은 방식으로 스위칭

## ✅ 스위치의 구조

### ✔️ 크로스바(Cross-bar) 구조

- **점-대-점 연결을 최적화**하기 위해 설계된 구조
- 여러 개의 **입력선과 출력선을 교차**시키는 형태 → 입력과 출력이 **만나는 지점에서 스위칭**이 이루어짐
- 여러 개의 도로가 하나의 교차로를 지나는 형태와 유사
- 입력선 개수 m, 출력선 개수 n일 때, (m * n)개의 연결점이 필요
- (m + n - 1)개의 제어소자로 스위치 역할 수행


### ✔️ 공유 메모리(Share memory) 구조

스위치의 모든 **입력 버퍼들이 하나의 중앙 메모리**에 있는 구조

### ✔️ 고속버스(High-speed Bus) 구조

- 스위칭 ASIC 칩(주문형 반도체)들 사이에 **고속의 데이터 버스가 연결**되어 있는 구조
    - ASIC(Application Specific Integrated Circuit): 주문형 반도체. 스위칭 ASIC 칩들 사이의 고속의 데이터버스와 연결되어 최대 속도 전송 가능
    - 데이터 버스는 각 포트의 **최대 전송 속도를 동시에 처리**할 수 있도록 설계되었음 → 각 포트가 독립적으로 최대 속도로 데이터를 처리할 수 있음
    - 여러 포트가 동시에 데이터를 전송해도 **병목 현상이 발생하지 않음**
- **`Non-blocking 스위치`**: 여러 포트가 동시에 데이터를 전송해도 데이터 경로가 막히지 않음